<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Test Bluetooth</title>
  </head>

  <body>
    <section>
      <button onclick="bluetoothUser()">INICIAR BLUETOOTH</button>
    </section>

    <script>
      alert('cambio')
      /* DETECTAR BLUETOOTH USUARIO */
      async function bluetoothUser() {
        let filters = [
          { services: ["heart_rate"] },
          { services: [0x1802, 0x1803] },
          { services: ["c48e6067-5295-48d3-8d5c-0395f61792b1"] },
          { name: "ExampleName" },
          { namePrefix: "Prefix" },
        ];

        let options = {};

        options.acceptAllDevices = true;
        //options.filters = filters

        try {
          console.log("Requesting Bluetooth Device...")
          console.log("with " + JSON.stringify(options))
          const device = await navigator.bluetooth.requestDevice(options)

          console.log("> Name:             " + device.name)
          console.log("> Id:               " + device.id)
          console.log("> Connected:        " + device.gatt.connected)
        } catch (error) {
          console.log("Argh! " + error);
        }
      }
      /* end DETECTAR BLUETOOTH USUARIO */


      function recordNearbyBeacon(major, minor, pathLossVs1m) { 
        console.log(major)
        console.log(minor)
        console.log(minor)
       }
      navigator.bluetooth.requestLEScan({
        filters: [{manufacturerData: {0x004C: {dataPrefix: new Uint8Array([
          0x02, 0x15, // iBeacon identifier.
          0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15  // My beacon UUID.
        ])}}}],
        keepRepeatedDevices: true
      }).then(() => {
        navigator.bluetooth.addEventListener('advertisementreceived', event => {
          let appleData = event.manufacturerData.get(0x004C);
          if (appleData.byteLength != 23) {
            // Isnâ€™t an iBeacon.
            return;
          }
          let major = appleData.getUint16(18, false);
          let minor = appleData.getUint16(20, false);
          let txPowerAt1m = -appleData.getInt8(22);
          let pathLossVs1m = txPowerAt1m - event.rssi;

          recordNearbyBeacon(major, minor, pathLossVs1m);
        });
      })
    </script>
  </body>
</html>
